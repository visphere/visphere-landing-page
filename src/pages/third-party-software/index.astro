---
/*
 * Copyright (c) 2023 by MoonSphere Systems
 * Originally developed by Milosz Gilga <https://miloszgilga.pl>
 */
import axios from 'axios';
import { InteractiveLibraries } from '~/ax-csr/components/third-party-libraries';
import { PageHeaderVariant } from '~/ax-ssr/components/Header.astro';
import { environment } from '~/env/environment';
import { useTranslationsSSR } from '~/i18n/translations';
import { i18nClientHref, i18nHref } from '~/i18n/url-parser';
import { getSafetyLocaleSSR } from '~/i18n/utils';
import MainLayout from '~/layouts/main-layout.astro';

type LibraryData = {
  name: string;
  repoUrl: string;
};

const { lang, locale } = getSafetyLocaleSSR(Astro.url);
const t = useTranslationsSSR('msph.landingPage.thirdPartySoftware.pageContent');

const { clientBaseUrl, contentDistributorBaseXHR: cdnBaseXHR } = environment;

const { data: libsData } = await axios.get(
  `${cdnBaseXHR}/static/misc/libraries.json`
);

const headerContent = `${t('totalLibraries').replace(
  '{libsCount}',
  libsData.length
)}`;

const headerVariant: PageHeaderVariant = {};
---

<MainLayout i18nPageId="thirdPartySoftware" headerVariant={headerVariant}>
  <div slot="headerContent">
    <h1 class="msph-root-header">
      {t('header')}
    </h1>
    <p class="mb-3">
      {t('paragraph1')}{' '}
      <a href={i18nHref('/licenses', lang)} class="msph-primary-href"
        >{t('belowLink')}</a
      >.
    </p>
    <p class="mb-3">
      {t('paragraph2')}{' '}
      <a href={i18nHref('/about', lang)} class="msph-primary-href"
        >{t('belowLink')}</a
      >.
    </p>
  </div>
  <div slot="mainContent">
    <section class="bg-gray-950 text-white overflow-hidden">
      <div class="msph_ratio-container px-3 h-[800px] overflow-hidden">
        <InteractiveLibraries client:load headerContent={headerContent}>
          {
            libsData.map(({ name, repoUrl }: LibraryData) => (
              <li class="flex sm:odd:justify-end sm:even:justify-start">
                <a
                  href={repoUrl}
                  title={name}
                  target="_blank"
                  rel="noreferrer"
                  class="truncate hover:text-gray-300 text-xl">
                  {name}
                </a>
              </li>
            ))
          }
        </InteractiveLibraries>
      </div>
    </section>
    <section class="msph_ratio-container my-10 sm:my-20 px-3">
      <p class="text-2xl md:text-3xl font-extrabold text-center mb-7">
        {t('areYouLost')}
      </p>
      <div
        class="flex flex-col gap-y-2 sm:gap-y-0 sm:flex-row justify-center gap-x-4">
        <a href={i18nHref('/download', lang)} class="msph-download-app-button">
          {t('downloadApp')}</a
        >
        <a
          href={i18nClientHref(clientBaseUrl!, locale)}
          class="msph-open-app-in-browser-button">
          {t('openAppInBrowser')}</a
        >
      </div>
    </section>
  </div>
</MainLayout>
 ~/ax-csr/components/third-party-libraries/InteractiveLibraries
